<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">

	<title>ISA Admin</title>
	<!-- main page icon -->
	<link rel="shortcut icon" href="https://miamioh.edu/fbs/_files/images/page-content/controller/staff/block-m.jpg">

	<!-- Style sheet -->
	<link rel="stylesheet" href="./front-end/style.css">


	<!-- JQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"> </script>

	<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" defer></script>

	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

	<!-- Compiled and minified JavaScript -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

	<!-- icons pack -->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


	<!-- bootstrap -->
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

</head>



</style>

<body>


	<!-- header --->
	<nav>
		<div class="nav-wrapper header">
			<p class="brand-logo center">Scholarship Submisions</p>
		</div>
	</nav>


	<!-- Summary Area -->
	<div class="row" style="padding: 5vh;">
		<div class="col s4"> </div>
		<div class="col s4">
			<table class="center">
				<tbody>
					<tr>
						<td class="center" style="font-weight: 700 ;"> Summary </td>
					</tr>
					<tr>
						<td class="center">Total Submission: 10</td>
					</tr>
					<tr>
						<td class="center">Average GPA: 3.0</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="col s4"> </div>
	</div>



	<div class="container center" style="padding-bottom: 5vh;" id="test">

		<table id="studentDataTable" class="table table-striped table-bordered" cellspacing="0" width="100%"
			style="padding: 5vh;">
			<thead>
				<tr>
					<th class="th-sm">Name</th>
					<th class="th-sm">Application Date</th>
					<th class="th-sm">Grad. Year</th>
					<th class="th-sm">Major(s)</th>
					<th class="th-sm">Minor(s)</th>
					<th class="th-sm">Cum. GPA</th>
					<th class="th-sm">ISA GPA</th>
					<th class="th-sm">Maj. GPA</th>
					<th class="th-sm"> ISA Grades </th>
					<th class="th-sm"> DARS </th>
					<th class="th-sm"> CV </th>
				</tr>
			</thead>
			<tbody id="studentDataTableBody">

				
			</tbody>
		</table>
	</div>


	<!-- download all-->
	<div class="container center">
		<a class="btn waves-effect waves-light" onclick="downloadResults()" style="background-color: #d94141;"> Download Results</a>
	</div>



	<!--  footer -->
	<div style="padding-bottom: 5vh;"> </div>



</body>


<script>

	let students = {}; //all students stored by uid
	let grades = {}; //all grades stored by uid

	//on page load...
	$(document).ready(function () {
		//DB Call for all application info + load summary (total apps and avg gpa)
		loadStudents();
	});

	function loadStudents(){
		//store name, app date
		$.ajax({
			type: "GET",
			url: "../back-end/students.csv",
			dataType: "text",
			success: function (data) {
				var dbFile = processData(data);
				
				dbFile.forEach(function(info){
					info = info.split(',');
					students[info[0]] = {'Name':info[1], 'App Date':info[3], 'Year': '--', 'Major': '--','Minor': '--','cum gpa': '--','isa gpa': '--','maj gpa': '--' }; //add new student
					
				});
			}
		});
		loadAdditionalInfo();
	}

	function loadAdditionalInfo(){
		//store grad year, majors, minors, cum gpa, maj gpa, isa gpa. dars, cv
		$.ajax({
			type: "GET",
			url: "../back-end/studentInfo.csv",
			dataType: "text",
			success: function (data) {
				var studentInfoFile = processData(data);

				studentInfoFile.forEach(function(info){
					info = info.split(',');

					students[info[0]]['Year'] = "20" + info[1];
					
				});
				loadGrades();
				appendToTable(students);
			}
		});
	}


	function loadGrades(){
		//store  isa grades
		$.ajax({
			type: "GET",
			url: "../back-end/studentGrades.csv",
			dataType: "text",
			success: function (data) {
				var gradesFile = processData(data);
				
				gradesFile.forEach(function(info){
					info = info.split(',');
					grades[info[0]] = info.slice(1, info.length); 
				});
			}
		});
	}

	//adding an element to table
	function appendToTable(info, table){
		let entry = "";

		for(var student in info){
				entry += 
					"<tr>" +
						"<td>"+  info[student]['Name'] +"</td>" + //name
						"<td>"+ info[student]['App Date'] +"</td>" +	
						"<td>"+ info[student]['Year'] +"</td>" + // application date
						"<td> -- </td>" +
						"<td> -- </td>" +
						"<td> -- </td>" +
						"<td> -- </td>" +
						"<td> -- </td>" +
						"<td class='center'><i class='material-icons'> edit </i></td>" +
						"<td class='center'><i class='material-icons'> folder_open </i></td>" +
						"<td class='center'><i class='material-icons'> format_align_left </i></td>" +
					"</tr>";
		}

		$("#studentDataTableBody").append(entry);
	}



	function processData(allText) {
		var allTextLines = allText.split(/\r\n|\n/);
		var headers = allTextLines[0].split(',');
		allTextLines = allTextLines.slice(1); //remove header for reading
		var lines = [];

		allTextLines.forEach(function(element){
			if(element.split(',').length > 0){
				lines.push(element);
			}
		});

		return lines;
	}




	//test basic client file download
	function downloadResults(){


        $.ajax({
            url: "../downloadStudent.php",
            method: "post",
            data: {'students':students},
            success: function(){
            	window.open("../downloadStudent.php");
            }
        });
	}



	// function search() {
	// 	// Declare variables
	// 	var input, filter, table, tr, td, i, txtValue;
	// 	input = document.getElementById("myInput");
	// 	filter = input.value.toUpperCase();
	// 	table = document.getElementById("studentDataTable");
	// 	tr = table.getElementsByTagName("tr");

	// 	// Loop through all table rows, and hide those who don't match the search query
	// 	for (i = 0; i < tr.length; i++) {
	// 		td = tr[i].getElementsByTagName("td")[0];
	// 		if (td) {
	// 			txtValue = td.textContent || td.innerText;
	// 			if (txtValue.toUpperCase().indexOf(filter) > -1) {
	// 				tr[i].style.display = "";
	// 			} else {
	// 				tr[i].style.display = "none";
	// 			}
	// 		}
	// 	}
	// }

	// function sortTable(n) {
	// 	var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
	// 	table = document.getElementById("studentDataTable");
	// 	switching = true;
	// 	// Set the sorting direction to ascending:
	// 	dir = "asc";
	// 	/* Make a loop that will continue until
	// 	no switching has been done: */
	// 	while (switching) {
	// 		// Start by saying: no switching is done:
	// 		switching = false;
	// 		rows = table.rows;
	// 		/* Loop through all table rows (except the
	// 		first, which contains table headers): */
	// 		for (i = 1; i < (rows.length - 1); i++) {
	// 			// Start by saying there should be no switching:
	// 			shouldSwitch = false;
	// 			/* Get the two elements you want to compare,
	// 			one from current row and one from the next: */
	// 			x = rows[i].getElementsByTagName("TD")[n];
	// 			y = rows[i + 1].getElementsByTagName("TD")[n];
	// 			/* Check if the two rows should switch place,
	// 			based on the direction, asc or desc: */
	// 			if (dir == "asc") {
	// 				if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
	// 					// If so, mark as a switch and break the loop:
	// 					shouldSwitch = true;
	// 					break;
	// 				}
	// 			} else if (dir == "desc") {
	// 				if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
	// 					// If so, mark as a switch and break the loop:
	// 					shouldSwitch = true;
	// 					break;
	// 				}
	// 			}
	// 		}
	// 		if (shouldSwitch) {
	// 			/* If a switch has been marked, make the switch
	// 			and mark that a switch has been done: */
	// 			rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
	// 			switching = true;
	// 			// Each time a switch is done, increase this count by 1:
	// 			switchcount++;
	// 		} else {
	// 			/* If no switching has been done AND the direction is "asc",
	// 			set the direction to "desc" and run the while loop again. */
	// 			if (switchcount == 0 && dir == "asc") {
	// 				dir = "desc";
	// 				switching = true;
	// 			}
	// 		}
	// 	}
	// }






</script>


</html>
