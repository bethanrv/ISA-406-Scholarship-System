<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">

	<title>ISA Admin</title>
	<!-- main page icon -->
	<link rel="shortcut icon" href="https://miamioh.edu/fbs/_files/images/page-content/controller/staff/block-m.jpg">

	<!-- Style sheet -->
	<link rel="stylesheet" href="./front-end/style.css">


	<!-- JQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"> </script>

	<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" defer></script>

	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

	<!-- Compiled and minified JavaScript -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

	<!-- icons pack -->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


	<!-- bootstrap -->
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

</head>



</style>

<body>


	<!-- header --->
	<nav>
		<div class="nav-wrapper header">
			<p class="brand-logo center">Scholarship Submisions</p>
		</div>
	</nav>


	<!-- Summary Area -->
	<div class="row" style="padding: 5vh;">
		<div class="col s4"> </div>
		<div class="col s4">
			<table class="center">
				<tbody>
					<tr>
						<td class="center" style="font-weight: 700 ;"> Summary </td>
					</tr>
					<tr>
						<td class="center">Total Submission: 10</td>
					</tr>
					<tr>
						<td class="center">Average GPA: 3.0</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="col s4"> </div>
	</div>



	<div class="container center" style="padding-bottom: 5vh;" id="test">

		<table id="studentDataTable" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%"
			style="padding: 5vh;">
			<thead>
				<tr>
					<th class="th-sm">Name</th>
					<th class="th-sm">Year</th>
					<th class="th-sm">Application Date</th>
					<th class="th-sm">Major(s)</th>
					<th class="th-sm">Minor(s)</th>
					<th class="th-sm">Cum. GPA</th>
					<th class="th-sm">ISA GPA</th>
					<th class="th-sm">Maj. GPA</th>
					<th class="th-sm"> ISA Grades </th>
					<th class="th-sm"> DARS </th>
					<th class="th-sm"> CV </th>
				</tr>
			</thead>
			<tbody id="studentDataTableBody">

				<!--Example table element (do not remove)-->
				<tr style="display: none;">
					<td>James P. Sullivan</td>
					<td>Junior</td>
					<td>4/13/2020</td>
					<td>ISA</td>
					<td>none</td>
					<td>2.5</td>
					<td>2.9</td>
					<td>2.8</td>
					<td class="center"><i class="material-icons"> edit </i></td>
					<td class="center"><i class="material-icons"> folder_open </i></td>
					<td class="center"><i class="material-icons"> format_align_left </i></td>
				</tr>
			</tbody>
		</table>
	</div>


	<!-- download all-->
	<div class="container center">
		<a class="btn waves-effect waves-light" style="background-color: #d94141;"> Download Results</a>
	</div>



	<!--  footer -->
	<div style="padding-bottom: 5vh;"> </div>



</body>


<script>

	let flag = true;

	//on page load...
	$(document).ready(function () {
		//DB Call for all application info + load summary (total apps and avg gpa)
		if(flag){
			$.ajax({
				type: "GET",
				url: "../back-end/students.csv",
				dataType: "text",
				success: function (data) {
					processData(data);
					var dbFile = processData(data);

					dbFile.forEach(function(element){
						appendToTable(element);
					});

				}
			});
		}

	});

	//adding an element to table
	function appendToTable(info, table){

		let entry = "";

		info = info.split(',');

		console.log(info);

		entry += 
			"<tr>" +
				"<td>"+  info[1] +"</td>" +
				"<td> -- </td>" +
				"<td>"+  info[3] +"</td>" +
				"<td> -- </td>" +
				"<td> -- </td>" +
				"<td> -- </td>" +
				"<td> -- </td>" +
				"<td> -- </td>" +
				"<td class='center'><i class='material-icons'> edit </i></td>" +
				"<td class='center'><i class='material-icons'> folder_open </i></td>" +
				"<td class='center'><i class='material-icons'> format_align_left </i></td>" +
			"</tr>";

		$("#studentDataTableBody").append(entry);
	}


	//table sorting
	// Must add custom sory
	$(document).ready(function () {
		$('#studentDataTable').DataTable({
			"ordering": true, // false to disable sorting (or any other option)
			"paging": false
		});
		$('.dataTables_length').addClass('bs-select');
	});



	function processData(allText) {
		var allTextLines = allText.split(/\r\n|\n/);
		var headers = allTextLines[0].split(',');
		allTextLines = allTextLines.slice(1); //remove header for reading
		var lines = [];

		allTextLines.forEach(function(element){
			if(element.split(',').length > 0){
				lines.push(element);
			}
		});

		return lines;

	}

	function search() {
		// Declare variables
		var input, filter, table, tr, td, i, txtValue;
		input = document.getElementById("myInput");
		filter = input.value.toUpperCase();
		table = document.getElementById("studentDataTable");
		tr = table.getElementsByTagName("tr");

		// Loop through all table rows, and hide those who don't match the search query
		for (i = 0; i < tr.length; i++) {
			td = tr[i].getElementsByTagName("td")[0];
			if (td) {
				txtValue = td.textContent || td.innerText;
				if (txtValue.toUpperCase().indexOf(filter) > -1) {
					tr[i].style.display = "";
				} else {
					tr[i].style.display = "none";
				}
			}
		}
	}

	function sortTable(n) {
		var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
		table = document.getElementById("studentDataTable");
		switching = true;
		// Set the sorting direction to ascending:
		dir = "asc";
		/* Make a loop that will continue until
		no switching has been done: */
		while (switching) {
			// Start by saying: no switching is done:
			switching = false;
			rows = table.rows;
			/* Loop through all table rows (except the
			first, which contains table headers): */
			for (i = 1; i < (rows.length - 1); i++) {
				// Start by saying there should be no switching:
				shouldSwitch = false;
				/* Get the two elements you want to compare,
				one from current row and one from the next: */
				x = rows[i].getElementsByTagName("TD")[n];
				y = rows[i + 1].getElementsByTagName("TD")[n];
				/* Check if the two rows should switch place,
				based on the direction, asc or desc: */
				if (dir == "asc") {
					if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
						// If so, mark as a switch and break the loop:
						shouldSwitch = true;
						break;
					}
				} else if (dir == "desc") {
					if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
						// If so, mark as a switch and break the loop:
						shouldSwitch = true;
						break;
					}
				}
			}
			if (shouldSwitch) {
				/* If a switch has been marked, make the switch
				and mark that a switch has been done: */
				rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
				switching = true;
				// Each time a switch is done, increase this count by 1:
				switchcount++;
			} else {
				/* If no switching has been done AND the direction is "asc",
				set the direction to "desc" and run the while loop again. */
				if (switchcount == 0 && dir == "asc") {
					dir = "desc";
					switching = true;
				}
			}
		}
	}








</script>


</html>
